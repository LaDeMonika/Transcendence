services:
##DATABASE##
   postgres:
     build:
       context: ./docker/database/.
     container_name: postgres
     environment:
       POSTGRES_USER: ${DB_USER}
       POSTGRES_PASSWORD: ${DB_PASSWORD}
       POSTGRES_DB: ${DB_DATABASE}
     networks:
       - transcendence
####no data folder yet, to be changed later###
     volumes:
       - postgres-data:/var/lib/postgresql/data
     restart: unless-stopped
     expose:
       - "5432"
     ports:
       - "5432:5432"
##BACKEND##
   adonis:
     build:
       context: .
       dockerfile: docker/backend/Dockerfile
     container_name: adonis
     restart: unless-stopped
     depends_on:
       - postgres
     networks:
       - transcendence
     environment:
       - PORT=3333
       - DB_HOST=postgres  
       #HOST: 0.0.0.0
     expose:
       - 3333
     ports:
       - "3333:3333"
##FRONTEND##
   vue:
     build:
       context: .
       dockerfile: docker/frontend/Dockerfile
     container_name: vue
     restart: unless-stopped
     expose:
       - "5173"
     volumes:
       - ./srcs/frontend:/app
       - /app/node_modules
     networks:
       - transcendence
     command: npm run dev
##NGINX##
   nginx:
     image: nginx:alpine
     container_name: nginx
     
     restart: unless-stopped
     depends_on:
       - adonis
     ports:
       - "80:80"
       - "443:443"
     volumes:
       - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
       - ./docker/nginx/conf.d:/etc/nginx/conf.d:ro
       - ./docker/nginx/ssl:/etc/nginx/ssl:ro
       #- ./srcs/frontend/dist:/var/www/html:ro
     networks:
       - transcendence
##VOLUMES##
volumes:
  postgres-data:
    driver: local
##NETWORK##
networks:
  transcendence:
    driver: bridge
